
ALTER TABLE LDB1_MAINT_WORKORDER ADD FWORKGROUPID NUMBER(10,0);

------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_MANAGESCHEDULE AS
SELECT S.FSITEID,S.FSCHEDULEID,S.FMAINTENANCENAME,S.FMAINDESCRIPTION,DECODE(ME.FEQUIPMENTNAME,NULL,ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPORLOCATION
,M1.FNAME AS FMAINTTYPE,S.FPRIORITYTYPE AS FPRIORITY,M3.FNAME AS FWORKGROUP,S.FSCHEDULESTATUS,S.FSCHD_RULE_DESC_TYPE,S.FSCHD_RULE_DESC

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID 
WHERE MU.FWORKGROUPID=S.FWORKGROUPID AND MU.FUSERTYPE='A' AND MU.FSTATUS='A') AS FASSIGNEE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID 
WHERE MU.FWORKGROUPID=S.FWORKGROUPID AND MU.FUSERTYPE='R' AND MU.FSTATUS='A') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME)/60,2) FROM LDB1_MAINT_TASKGROUP TG INNER JOIN LDB1_MAINT_TASKS MT ON MT.FREFERENCEID=TG.FTASKGROUPID WHERE TG.FIDENTIFIER=S.FTASKGROUPIDENTIFIER AND TG.FSITEID=S.FSITEID AND TG.FSTATUS='A') AS FESTIMATEDTIME
,(SELECT MIN(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=S.FSCHEDULEID AND W.FSITEID=S.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FNEXTDUEDATE
--,(SELECT MAX(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=S.FSCHEDULEID AND W.FSITEID=S.FSITEID AND W.FSTATUS='S') AS FLASTDUEDATE
,(SELECT MAX(FSCHEDULEDATE) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=S.FSCHEDULEID AND W.FSITEID=S.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FLASTDUEDATE

,SD.FSCHEDULE_DTL_ID,S.FSCHEDULESTATUS AS FSCHEDULESTATUSVALUE
FROM LDB1_MAINT_SCHEDULE S
INNER JOIN LDB1_MAINT_MASTER M1 ON M1.FMASTERID=S.FMAINTYPEID AND M1.FSITEID=S.FSITEID AND M1.FTYPE='MAINT_TYPE'
INNER JOIN LDB1_MAINT_MASTER M3 ON M3.FMASTERID=S.FWORKGROUPID AND M3.FSITEID=S.FSITEID AND M3.FTYPE='WORKGROUP'
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FSITEID=S.FSITEID AND ML.FLOCATIONID=S.FLOCATIONID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FSITEID=S.FSITEID AND ME.FEQUIPMENTID=S.FEQUIPMENTID
LEFT OUTER JOIN LDB1_MAINT_SCHEDULE_DTL SD ON SD.FSCHEDULEID=S.FSCHEDULEID AND ROWNUM=1 AND SD.FSTATUS='A'
WHERE S.FSCHEDULE_TYPE='S' AND S.FSTATUS='A' 
ORDER BY S.FUPDATEDON DESC,S.FUPDATEDTIME DESC,S.FCREATEDON DESC;
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_PLNTUSR_MANAGSCHEDULE AS
SELECT DISTINCT S.FSITEID,S.FSCHEDULEID,S.FMAINTENANCENAME,S.FMAINDESCRIPTION,DECODE(ME.FEQUIPMENTNAME,NULL,ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPORLOCATION
,MA.FREFERENCEID,WU.FUSERID,S.FUPDATEDON ,S.FUPDATEDTIME,S.FCREATEDON
,M1.FNAME AS FMAINTTYPE,S.FPRIORITYTYPE AS FPRIORITY,M3.FNAME AS FWORKGROUP,S.FSCHEDULESTATUS,S.FSCHD_RULE_DESC_TYPE,S.FSCHD_RULE_DESC

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID 
WHERE MU.FWORKGROUPID=S.FWORKGROUPID AND MU.FUSERTYPE='A' AND MU.FSTATUS='A') AS FASSIGNEE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID 
WHERE MU.FWORKGROUPID=S.FWORKGROUPID AND MU.FUSERTYPE='R' AND MU.FSTATUS='A') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME)/60,2) FROM LDB1_MAINT_TASKGROUP TG INNER JOIN LDB1_MAINT_TASKS MT ON MT.FREFERENCEID=TG.FTASKGROUPID WHERE TG.FIDENTIFIER=S.FTASKGROUPIDENTIFIER AND TG.FSITEID=S.FSITEID AND TG.FSTATUS='A') AS FESTIMATEDTIME
,(SELECT MIN(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=S.FSCHEDULEID AND W.FSITEID=S.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FNEXTDUEDATE
--,(SELECT MAX(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=S.FSCHEDULEID AND W.FSITEID=S.FSITEID AND W.FSTATUS='S') AS FLASTDUEDATE
,(SELECT MAX(FSCHEDULEDATE) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=S.FSCHEDULEID AND W.FSITEID=S.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FLASTDUEDATE
,SD.FSCHEDULE_DTL_ID,S.FSCHEDULESTATUS AS FSCHEDULESTATUSVALUE
FROM LDB1_MAINT_SCHEDULE S
INNER JOIN LDB1_MAINT_MASTER M1 ON M1.FMASTERID=S.FMAINTYPEID AND M1.FSITEID=S.FSITEID AND M1.FTYPE='MAINT_TYPE'
INNER JOIN LDB1_MAINT_MASTER M3 ON M3.FMASTERID=S.FWORKGROUPID AND M3.FSITEID=S.FSITEID AND M3.FTYPE='WORKGROUP'
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FSITEID=S.FSITEID AND ML.FLOCATIONID=S.FLOCATIONID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FSITEID=S.FSITEID AND ME.FEQUIPMENTID=S.FEQUIPMENTID
LEFT OUTER JOIN LDB1_MAINT_SCHEDULE_DTL SD ON SD.FSCHEDULEID=S.FSCHEDULEID AND SD.FITEM_ID=1 AND SD.FSTATUS='A'
LEFT OUTER JOIN LDB1_MAINT_AUTH_GROUP MA ON MA.FREFERENCEID=DECODE(NVL(S.FLOCATIONID,0),0,S.FEQUIPMENTID,S.FLOCATIONID) AND MA.FTYPE=DECODE(NVL(S.FLOCATIONID,0),0,'EQUIPMENT','LOCATION') AND MA.FSITEID=S.FSITEID AND MA.FSTATUS='A' AND MA.FWORKGROUPID=S.FWORKGROUPID
LEFT OUTER JOIN LDB1_MAINT_WORKGROUPUSER WU ON WU.FWORKGROUPID=MA.FWORKGROUPID AND WU.FSITEID=S.FSITEID AND WU.FSTATUS='A'
WHERE S.FSCHEDULE_TYPE='S' AND S.FSTATUS='A'
ORDER BY S.FUPDATEDON DESC, S.FUPDATEDTIME DESC,S.FCREATEDON DESC;
--------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_MANAGEWORKORDER AS
 SELECT S.FSITEID,S.FSCHEDULEID,S.FMAINTENANCENAME,DECODE(ME.FEQUIPMENTNAME,NULL,ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPORLOCATION
,M1.FNAME AS FMAINTTYPE,S.FPRIORITYTYPE AS FPRIORITY,M3.FNAME AS FWORKGROUP
,DECODE(NVL(MW.FERP_WORKORDER,'N'),'N',LTRIM(MW.FWORK_ORDERID,'0'),MW.FERP_WORKORDER) AS ERPWORKORDER

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=DECODE(NVL(MW.FWORKGROUPID,0),0,S.FWORKGROUPID,MW.FWORKGROUPID) AND MU.FUSERTYPE='A' AND MU.FSTATUS='A') AS FASSIGNEE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=DECODE(NVL(MW.FWORKGROUPID,0),0,S.FWORKGROUPID,MW.FWORKGROUPID) AND MU.FUSERTYPE='R' AND MU.FSTATUS='A') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME)/60,2) FROM LDB1_MAINT_TASKGROUP TG INNER JOIN LDB1_MAINT_TASKS MT ON MT.FREFERENCEID=TG.FTASKGROUPID WHERE TG.FIDENTIFIER=S.FTASKGROUPIDENTIFIER AND TG.FSITEID=S.FSITEID AND TG.FSTATUS='A') AS FESTIMATEDTIME
,MW.FWORKORDERSTATUS AS FSTATUS,MW.FWORKORDERSTATUS AS FSTATUSKEY,LTRIM(MW.FWORK_ORDERID,'0') AS FWORK_ORDERID,MW.FSCHEDULEDATE,MW.FSCHEDULETIME,MW.FPLANNEDDATE,MW.FPLANNEDTIME,S.FSCHEDULE_TYPE,MW.FSCHEDULETIME AS FSCHEDULETIME_NUM
,MW.FSCHEDULEDATE AS FSCHEDULEDBDATE,MW.FPLANNEDDATE AS FPLANNEDDBDATE
,TO_NUMBER(TO_CHAR(MW.FSTARTDATE || '' || LPAD(MW.FSTARTTIME,6,'0'))) AS FSTARTDATE,TO_NUMBER(TO_CHAR(MW.FENDDATE || '' || LPAD(MW.FENDTIME,6,'0'))) AS FENDDATE
,(U.FFIRSTNAME || ' ' || U.FLASTNAME) AS FSTARTEDBY
,TO_NUMBER(TO_CHAR(MW.FWORK_STARTDATE || '' || LPAD(MW.FWORK_STARTTIME,6,'0'))) AS FWORK_STARTDATE,TO_NUMBER(TO_CHAR(MW.FWORK_ENDDATE || '' || LPAD(MW.FWORK_ENDTIME,6,'0'))) AS FWORK_ENDDATE
,CASE NVL(MW.FLABORTIME,0) WHEN 0 THEN '' ELSE TO_CHAR(MW.FLABORTIME) END AS FLABORTIME,CASE NVL(MW.FTIMETAKEN,0) WHEN 0 THEN '' ELSE TO_CHAR(MW.FTIMETAKEN) END AS FACTUALDURATION
,TO_NUMBER(TO_CHAR(MW.FBREAKDOWN_STARTDATE || '' || LPAD(MW.FBREAKDOWN_STARTTIME,6,'0'))) AS FBREAKDOWN_STARTDATE,TO_NUMBER(TO_CHAR(MW.FBREAKDOWN_ENDDATE || '' || LPAD(MW.FBREAKDOWN_ENDTIME,6,'0'))) AS FBREAKDOWN_ENDDATE
,CASE NVL(MW.FBREAKDOWN_DURATION,0) WHEN 0 THEN '' ELSE TO_CHAR(MW.FBREAKDOWN_DURATION) END AS FBREAKDOWN_DURATION
FROM LDB1_MAINT_SCHEDULE S
INNER JOIN LDB1_MAINT_WORKORDER MW ON MW.FREF_SCHEDULEID=S.FSCHEDULEID AND MW.FSITEID=S.FSITEID AND MW.FWORKORDERSTATUS<>'INACTIVE'
INNER JOIN LDB1_MAINT_MASTER M1 ON M1.FMASTERID=S.FMAINTYPEID AND M1.FSITEID=S.FSITEID AND M1.FTYPE='MAINT_TYPE'
INNER JOIN LDB1_MAINT_MASTER M3 ON M3.FMASTERID=DECODE(NVL(MW.FWORKGROUPID,0),0,S.FWORKGROUPID,MW.FWORKGROUPID) AND M3.FSITEID=S.FSITEID AND M3.FTYPE='WORKGROUP'
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FSITEID=S.FSITEID AND ML.FLOCATIONID=S.FLOCATIONID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FSITEID=S.FSITEID AND ME.FEQUIPMENTID=S.FEQUIPMENTID
LEFT OUTER JOIN LDB1_USERINFO U ON U.FUSERID=MW.FSTARTEDBY
WHERE  S.FSTATUS='A' AND S.FSCHEDULE_TYPE IN ('S','W')
ORDER BY S.FUPDATEDON DESC, S.FUPDATEDTIME DESC,MW.FSCHEDULEDATE,MW.FSCHEDULETIME;
--ORDER BY MW.FSCHEDULEDATE,MW.FSCHEDULETIME,MW.FPLANNEDDATE ,MW.FPLANNEDTIME;
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_PLNTUSR_MANAGEWORKODR  AS
SELECT DISTINCT S.FSITEID,S.FSCHEDULEID,S.FMAINTENANCENAME,DECODE(ME.FEQUIPMENTNAME,NULL,ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPORLOCATION
,M1.FNAME AS FMAINTTYPE,S.FPRIORITYTYPE AS FPRIORITY,M3.FNAME AS FWORKGROUP,S.FTIMESTAMP,MA.FREFERENCEID,WU.FUSERID
,DECODE(NVL(MW.FERP_WORKORDER,'N'),'N',LTRIM(MW.FWORK_ORDERID,'0'),MW.FERP_WORKORDER) AS ERPWORKORDER,S.FUPDATEDON,S.FUPDATEDTIME

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=DECODE(NVL(MW.FWORKGROUPID,0),0,S.FWORKGROUPID,MW.FWORKGROUPID) AND MU.FUSERTYPE='A' AND MU.FSTATUS='A') AS FASSIGNEE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON MU.FSITEID=S.FSITEID AND U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=DECODE(NVL(MW.FWORKGROUPID,0),0,S.FWORKGROUPID,MW.FWORKGROUPID) AND MU.FUSERTYPE='R' AND MU.FSTATUS='A') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME)/60,2) FROM LDB1_MAINT_TASKGROUP TG INNER JOIN LDB1_MAINT_TASKS MT ON MT.FREFERENCEID=TG.FTASKGROUPID WHERE TG.FIDENTIFIER=S.FTASKGROUPIDENTIFIER AND TG.FSITEID=S.FSITEID AND TG.FSTATUS='A') AS FESTIMATEDTIME
,MW.FWORKORDERSTATUS AS FSTATUS,MW.FWORKORDERSTATUS AS FSTATUSKEY,LTRIM(MW.FWORK_ORDERID,'0') AS FWORK_ORDERID,MW.FSCHEDULEDATE,MW.FSCHEDULETIME,MW.FPLANNEDDATE,MW.FPLANNEDTIME,S.FSCHEDULE_TYPE,MW.FSCHEDULETIME AS FSCHEDULETIME_NUM
,MW.FSCHEDULEDATE AS FSCHEDULEDBDATE,MW.FPLANNEDDATE AS FPLANNEDDBDATE
,TO_NUMBER(TO_CHAR(MW.FSTARTDATE || '' || LPAD(MW.FSTARTTIME,6,'0'))) AS FSTARTDATE,TO_NUMBER(TO_CHAR(MW.FENDDATE || '' || LPAD(MW.FENDTIME,6,'0'))) AS FENDDATE
,(U.FFIRSTNAME || ' ' || U.FLASTNAME) AS FSTARTEDBY
,TO_NUMBER(TO_CHAR(MW.FWORK_STARTDATE || '' || LPAD(MW.FWORK_STARTTIME,6,'0'))) AS FWORK_STARTDATE,TO_NUMBER(TO_CHAR(MW.FWORK_ENDDATE || '' || LPAD(MW.FWORK_ENDTIME,6,'0'))) AS FWORK_ENDDATE
,CASE NVL(MW.FLABORTIME,0) WHEN 0 THEN '' ELSE TO_CHAR(MW.FLABORTIME) END AS FLABORTIME,CASE NVL(MW.FTIMETAKEN,0) WHEN 0 THEN '' ELSE TO_CHAR(MW.FTIMETAKEN) END AS FACTUALDURATION
,TO_NUMBER(TO_CHAR(MW.FBREAKDOWN_STARTDATE || '' || LPAD(MW.FBREAKDOWN_STARTTIME,6,'0'))) AS FBREAKDOWN_STARTDATE,TO_NUMBER(TO_CHAR(MW.FBREAKDOWN_ENDDATE || '' || LPAD(MW.FBREAKDOWN_ENDTIME,6,'0'))) AS FBREAKDOWN_ENDDATE
,CASE NVL(MW.FBREAKDOWN_DURATION,0) WHEN 0 THEN '' ELSE TO_CHAR(MW.FBREAKDOWN_DURATION) END AS FBREAKDOWN_DURATION
FROM LDB1_MAINT_SCHEDULE S
INNER JOIN LDB1_MAINT_WORKORDER MW ON MW.FREF_SCHEDULEID=S.FSCHEDULEID AND MW.FSITEID=S.FSITEID AND MW.FWORKORDERSTATUS<>'INACTIVE'
INNER JOIN LDB1_MAINT_MASTER M1 ON M1.FMASTERID=S.FMAINTYPEID AND M1.FSITEID=S.FSITEID AND M1.FTYPE='MAINT_TYPE'
INNER JOIN LDB1_MAINT_MASTER M3 ON M3.FMASTERID=DECODE(NVL(MW.FWORKGROUPID,0),0,S.FWORKGROUPID,MW.FWORKGROUPID) AND M3.FSITEID=S.FSITEID AND M3.FTYPE='WORKGROUP'
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FSITEID=S.FSITEID AND ML.FLOCATIONID=S.FLOCATIONID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FSITEID=S.FSITEID AND ME.FEQUIPMENTID=S.FEQUIPMENTID
LEFT OUTER JOIN LDB1_MAINT_AUTH_GROUP MA ON MA.FREFERENCEID=DECODE(NVL(S.FLOCATIONID,0),0,S.FEQUIPMENTID,S.FLOCATIONID) AND MA.FTYPE=DECODE(NVL(S.FLOCATIONID,0),0,'EQUIPMENT','LOCATION') AND MA.FSITEID=S.FSITEID AND MA.FSTATUS='A' AND MA.FWORKGROUPID=S.FWORKGROUPID
LEFT OUTER JOIN LDB1_MAINT_WORKGROUPUSER WU ON WU.FWORKGROUPID=MA.FWORKGROUPID AND WU.FSITEID=S.FSITEID AND WU.FSTATUS='A'
LEFT OUTER JOIN LDB1_USERINFO U ON U.FUSERID=MW.FSTARTEDBY
WHERE  S.FSTATUS='A' AND S.FSCHEDULE_TYPE IN ('S','W')
ORDER BY S.FUPDATEDON DESC, S.FUPDATEDTIME DESC,MW.FSCHEDULEDATE,MW.FSCHEDULETIME;
--ORDER BY MW.FSCHEDULEDATE,MW.FSCHEDULETIME,MW.FPLANNEDDATE ,MW.FPLANNEDTIME;
-------------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_MANAGECHECKLIST (FSCHEDULEID,FSITEID,FMAINTENANCENAME,FWORKGROUP,FSCHEDULESTATUS,FSCHD_RULE_DESC_TYPE,FSCHD_RULE_DESC,FMEASPOINTS,FASSIGNEE,FREPORTEDTO,FNEXTDUEDATE,FLASTDUEDATE,FSCHEDULE_DTL_ID,FSCHEDULESTATUSVALUE) AS 
SELECT MS.FSCHEDULEID,MS.FSITEID,MS.FMAINTENANCENAME, MM.FNAME AS FWORKGROUP,MS.FSCHEDULESTATUS,MS.FSCHD_RULE_DESC_TYPE,MS.FSCHD_RULE_DESC,
(SELECT LISTAGG(TO_CHAR(MP.FMEASURINGPOINTNAME),', ') WITHIN GROUP (ORDER BY MD.FITEMID) FROM LDB1_MAINT_MEASURINGPOINT MP INNER JOIN LDB1_MAINT_MEAS_DOCS MD ON 
MD.FSITEID=MP.FSITEID AND MD.FSCHEDULEID=MS.FSCHEDULEID AND MD.FMEASURINGPOINTID=MP.FMEASURINGPOINTID) AS FMEASPOINTS

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=MS.FWORKGROUPID AND MU.FSITEID=MS.FSITEID AND MU.FUSERTYPE='A' AND MU.FSTATUS='A') AS FASSIGNEE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=MS.FWORKGROUPID AND MU.FSITEID=MS.FSITEID AND MU.FUSERTYPE='R' AND MU.FSTATUS='A') AS FREPORTEDTO

,(SELECT MIN(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=MS.FSCHEDULEID AND W.FSITEID=MS.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FNEXTDUEDATE
,(SELECT MAX(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=MS.FSCHEDULEID AND W.FSITEID=MS.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FLASTDUEDATE
,SD.FSCHEDULE_DTL_ID,MS.FSCHEDULESTATUS AS FSCHEDULESTATUSVALUE
FROM LDB1_MAINT_SCHEDULE MS
INNER JOIN LDB1_MAINT_MASTER MM ON MM.FMASTERID=MS.FWORKGROUPID
LEFT OUTER JOIN LDB1_MAINT_SCHEDULE_DTL SD ON SD.FSCHEDULEID=MS.FSCHEDULEID AND SD.FITEM_ID=1 AND SD.FSTATUS='A'
WHERE MS.FSCHEDULE_TYPE='I' AND MS.FSTATUS='A'
ORDER BY MS.FUPDATEDON DESC,MS.FUPDATEDTIME DESC;
------------------------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_PLNTUSR_MANAGECHECKLT AS 
  SELECT DISTINCT MS.FSCHEDULEID,MS.FSITEID,MS.FMAINTENANCENAME, MM.FNAME AS FWORKGROUP,MS.FSCHEDULESTATUS,MS.FSCHD_RULE_DESC_TYPE,MS.FSCHD_RULE_DESC
,WU.FUSERID,MS.FUPDATEDON ,MS.FUPDATEDTIME
,(SELECT LISTAGG(TO_CHAR(MP.FMEASURINGPOINTNAME),', ') WITHIN GROUP (ORDER BY MD.FITEMID) FROM LDB1_MAINT_MEASURINGPOINT MP INNER JOIN LDB1_MAINT_MEAS_DOCS MD ON 
MD.FSITEID=MP.FSITEID AND MD.FSCHEDULEID=MS.FSCHEDULEID AND MD.FMEASURINGPOINTID=MP.FMEASURINGPOINTID) AS FMEASPOINTS

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=MS.FWORKGROUPID AND MU.FSITEID=MS.FSITEID AND MU.FUSERTYPE='A' AND MU.FSTATUS='A') AS FASSIGNEE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME) 
FROM LDB1_MAINT_WORKGROUPUSER MU INNER JOIN LDB1_USERINFO U ON U.FUSERID=MU.FUSERID
WHERE MU.FWORKGROUPID=MS.FWORKGROUPID AND MU.FSITEID=MS.FSITEID AND MU.FUSERTYPE='R' AND MU.FSTATUS='A') AS FREPORTEDTO

,(SELECT MIN(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=MS.FSCHEDULEID AND W.FSITEID=MS.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FNEXTDUEDATE
,(SELECT MAX(TO_NUMBER(TO_CHAR(FSCHEDULEDATE || '' || LPAD(FSCHEDULETIME,6,'0')))) FROM LDB1_MAINT_WORKORDER W WHERE W.FREF_SCHEDULEID=MS.FSCHEDULEID AND W.FSITEID=MS.FSITEID AND W.FWORKORDERSTATUS='SCHEDULED') AS FLASTDUEDATE
,SD.FSCHEDULE_DTL_ID,MS.FSCHEDULESTATUS AS FSCHEDULESTATUSVALUE
FROM LDB1_MAINT_SCHEDULE MS
INNER JOIN LDB1_MAINT_MASTER MM ON MM.FMASTERID=MS.FWORKGROUPID
INNER JOIN LDB1_MAINT_MEAS_DOCS DC ON DC.FSITEID=MS.FSITEID AND DC.FSCHEDULEID=MS.FSCHEDULEID
INNER JOIN LDB1_MAINT_MEASURINGPOINT PT ON PT.FSITEID=MS.FSITEID AND PT.FMEASURINGPOINTID=DC.FMEASURINGPOINTID AND PT.FPARENTTYPE IN ('E','L')
LEFT OUTER JOIN LDB1_MAINT_SCHEDULE_DTL SD ON SD.FSCHEDULEID=MS.FSCHEDULEID AND SD.FITEM_ID=1 AND SD.FSTATUS='A'
LEFT OUTER JOIN LDB1_MAINT_WORKGROUPUSER WU ON WU.FWORKGROUPID=MS.FWORKGROUPID AND WU.FSITEID=MS.FSITEID AND WU.FSTATUS='A'
where MS.FSCHEDULE_TYPE='I' and MS.FSTATUS='A'
ORDER BY MS.FUPDATEDON||MS.FUPDATEDTIME DESC;

-------------------------------------------------------------------------------------------------------------------
 CREATE OR REPLACE VIEW VW_MAINT_WORKORDER_DAYVIEW AS 
 SELECT WO.FWORK_ORDERID,WO.FSCHEDULEDATE,WO.FSITEID,DECODE(NVL(WO.FERP_WORKORDER,'N'),'N',LTRIM(WO.FWORK_ORDERID,'0'),WO.FERP_WORKORDER) AS WORKORDER,WO.FWORKORDERSTATUS AS FSTATUS
,MS.FMAINTENANCENAME,MS.FPRIORITYTYPE,DECODE(NVL(ME.FEQUIPMENTNAME,'N'),'N',ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPMENTNAME,MM.FNAME AS FMAINTANANCETYPE,WO.FPLANNEDDATE,WO.FWORKORDERSTATUS AS FSTATUSKEY
,MS.FWORKGROUPID,MW.FNAME AS FWORKGROUPNAME,WO.FPLANNEDDATE AS FDUEDATE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND WU.FUSERTYPE='A' AND WU.FSTATUS='A') AS FASSIGNEDTO

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND WU.FUSERTYPE='R' AND WU.FSTATUS='A') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME/60),2) FROM LDB1_MAINT_TASKS MT 
LEFT OUTER JOIN LDB1_MAINT_TASKGROUP TG ON TG.FIDENTIFIER=MS.FTASKGROUPIDENTIFIER AND TG.FSTATUS='A' AND TG.FSITEID=MS.FSITEID 
WHERE MT.FREFERENCEID=DECODE(NVL(WO.FTASKGROUPID,0),0,TG.FTASKGROUPID,WO.FTASKGROUPID) AND MT.FSITEID=MS.FSITEID) AS FESTIMATEDTIME 

,(SELECT NVL(SUM(NVL(ROUND((TO_DATE(FENDDATE||' '||LPAD(FENDTIME,6,'0'),'YYYYMMDD hh24miSS') 
- TO_DATE(FSTARTDATE||' '||LPAD(FSTARTTIME,6,'0'),'YYYYMMDD hh24miSS'))*24*60,2),0)),0)
FROM LDB1_MAINT_WORKORDER_TASK WT WHERE WT.FWORK_ORDERID=WO.FWORK_ORDERID AND WT.FSITEID=MS.FSITEID AND WT.FENDDATE>0) AS FACTUALTIME

,TO_NUMBER(TO_CHAR(WO.FSTARTDATE || '' || LPAD(WO.FSTARTTIME,6,'0'))) AS FSTARTDATE,TO_NUMBER(TO_CHAR(WO.FENDDATE || '' || LPAD(WO.FENDTIME,6,'0'))) AS FENDDATE
,(U.FFIRSTNAME || ' ' || U.FLASTNAME) AS FSTARTEDBY
,TO_NUMBER(TO_CHAR(WO.FWORK_STARTDATE || '' || LPAD(WO.FWORK_STARTTIME,6,'0'))) AS FWORK_STARTDATE,TO_NUMBER(TO_CHAR(WO.FWORK_ENDDATE || '' || LPAD(WO.FWORK_ENDTIME,6,'0'))) AS FWORK_ENDDATE
,CASE NVL(WO.FLABORTIME,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FLABORTIME) END AS FLABORTIME,CASE NVL(WO.FTIMETAKEN,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FTIMETAKEN) END AS FACTUALDURATION
,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_STARTDATE || '' || LPAD(WO.FBREAKDOWN_STARTTIME,6,'0'))) AS FBREAKDOWN_STARTDATE,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_ENDDATE || '' || LPAD(WO.FBREAKDOWN_ENDTIME,6,'0'))) AS FBREAKDOWN_ENDDATE
,CASE NVL(WO.FBREAKDOWN_DURATION,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FBREAKDOWN_DURATION) END AS FBREAKDOWN_DURATION
FROM LDB1_MAINT_WORKORDER WO
INNER JOIN LDB1_MAINT_SCHEDULE MS ON MS.FSCHEDULEID=WO.FREF_SCHEDULEID AND MS.FSITEID=WO.FSITEID
INNER JOIN LDB1_MAINT_MASTER MM ON MM.FMASTERID=MS.FMAINTYPEID AND MM.FSITEID=MS.FSITEID
INNER JOIN LDB1_MAINT_MASTER MW ON MW.FMASTERID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND MW.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FEQUIPMENTID=MS.FEQUIPMENTID AND ME.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FLOCATIONID=MS.FLOCATIONID AND ML.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_USERINFO U ON U.FUSERID=WO.FSTARTEDBY
WHERE WO.FWORKORDERSTATUS NOT IN('INACTIVE','CREATED')
ORDER BY CASE FWORKORDERSTATUS WHEN 'COMPLETED' THEN 2 ELSE 1 END;
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_PLNTUSR_WORKODR_DAYVW AS 
SELECT DISTINCT WO.FWORK_ORDERID,WO.FSCHEDULEDATE,WO.FSITEID,DECODE(NVL(WO.FERP_WORKORDER,'N'),'N',LTRIM(WO.FWORK_ORDERID,'0'),WO.FERP_WORKORDER) AS WORKORDER,WO.FWORKORDERSTATUS AS FSTATUS
,MS.FMAINTENANCENAME,MS.FPRIORITYTYPE,DECODE(NVL(ME.FEQUIPMENTNAME,'N'),'N',ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPMENTNAME,MM.FNAME AS FMAINTANANCETYPE,WO.FPLANNEDDATE,WO.FWORKORDERSTATUS AS FSTATUSKEY
,MS.FWORKGROUPID,MW.FNAME AS FWORKGROUPNAME,MA.FREFERENCEID,WU.FUSERID,WO.FPLANNEDDATE AS FDUEDATE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND FUSERTYPE='A') AS FASSIGNEDTO

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FFIRSTNAME))||' '||INITCAP(TO_CHAR(U.FLASTNAME))),',') WITHIN GROUP (ORDER BY U.FFIRSTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND FUSERTYPE='R') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME/60),2) FROM LDB1_MAINT_TASKS MT 
LEFT OUTER JOIN LDB1_MAINT_TASKGROUP TG ON TG.FIDENTIFIER=MS.FTASKGROUPIDENTIFIER AND TG.FSTATUS='A' AND TG.FSITEID=MS.FSITEID 
WHERE MT.FREFERENCEID=DECODE(NVL(WO.FTASKGROUPID,0),0,TG.FTASKGROUPID,WO.FTASKGROUPID) AND MT.FSITEID=MS.FSITEID) AS FESTIMATEDTIME 

,(SELECT NVL(SUM(NVL(ROUND((TO_DATE(FENDDATE||' '||LPAD(FENDTIME,6,'0'),'YYYYMMDD hh24miSS') 
- TO_DATE(FSTARTDATE||' '||LPAD(FSTARTTIME,6,'0'),'YYYYMMDD hh24miSS'))*24*60,2),0)),0)
FROM LDB1_MAINT_WORKORDER_TASK WT WHERE WT.FWORK_ORDERID=WO.FWORK_ORDERID AND WT.FSITEID=MS.FSITEID AND WT.FENDDATE>0) AS FACTUALTIME

,TO_NUMBER(TO_CHAR(WO.FSTARTDATE || '' || LPAD(WO.FSTARTTIME,6,'0'))) AS FSTARTDATE,TO_NUMBER(TO_CHAR(WO.FENDDATE || '' || LPAD(WO.FENDTIME,6,'0'))) AS FENDDATE
,(U.FFIRSTNAME || ' ' || U.FLASTNAME) AS FSTARTEDBY
,TO_NUMBER(TO_CHAR(WO.FWORK_STARTDATE || '' || LPAD(WO.FWORK_STARTTIME,6,'0'))) AS FWORK_STARTDATE,TO_NUMBER(TO_CHAR(WO.FWORK_ENDDATE || '' || LPAD(WO.FWORK_ENDTIME,6,'0'))) AS FWORK_ENDDATE
,CASE NVL(WO.FLABORTIME,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FLABORTIME) END AS FLABORTIME,CASE NVL(WO.FTIMETAKEN,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FTIMETAKEN) END AS FACTUALDURATION
,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_STARTDATE || '' || LPAD(WO.FBREAKDOWN_STARTTIME,6,'0'))) AS FBREAKDOWN_STARTDATE,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_ENDDATE || '' || LPAD(WO.FBREAKDOWN_ENDTIME,6,'0'))) AS FBREAKDOWN_ENDDATE
,CASE NVL(WO.FBREAKDOWN_DURATION,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FBREAKDOWN_DURATION) END AS FBREAKDOWN_DURATION
FROM LDB1_MAINT_WORKORDER WO
INNER JOIN LDB1_MAINT_SCHEDULE MS ON MS.FSCHEDULEID=WO.FREF_SCHEDULEID AND MS.FSITEID=WO.FSITEID
INNER JOIN LDB1_MAINT_MASTER MM ON MM.FMASTERID=MS.FMAINTYPEID AND MM.FSITEID=MS.FSITEID
INNER JOIN LDB1_MAINT_MASTER MW ON MW.FMASTERID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND MW.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FEQUIPMENTID=MS.FEQUIPMENTID AND ME.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FLOCATIONID=MS.FLOCATIONID AND ML.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_AUTH_GROUP MA ON MA.FREFERENCEID=DECODE(NVL(MS.FLOCATIONID,0),0,MS.FEQUIPMENTID,MS.FLOCATIONID) AND MA.FTYPE=DECODE(NVL(MS.FLOCATIONID,0),0,'EQUIPMENT','LOCATION') AND MA.FSITEID=MS.FSITEID AND MA.FSTATUS='A'
LEFT OUTER JOIN LDB1_MAINT_WORKGROUPUSER WU ON WU.FWORKGROUPID=MA.FWORKGROUPID AND WU.FSITEID=MS.FSITEID AND WU.FSTATUS='A'
LEFT OUTER JOIN LDB1_USERINFO U ON U.FUSERID=WO.FSTARTEDBY
WHERE WO.FWORKORDERSTATUS NOT IN('INACTIVE','CREATED')
ORDER BY CASE FSTATUS WHEN 'COMPLETED' THEN 2 ELSE 1 END;

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE OR REPLACE VIEW VW_MAINT_WORKORDER_ORDERVIEW AS 
 SELECT WO.FWORK_ORDERID,WO.FSITEID,DECODE(NVL(WO.FERP_WORKORDER,'N'),'N',LTRIM(WO.FWORK_ORDERID,'0'),WO.FERP_WORKORDER) AS WORKORDER,WO.FWORKORDERSTATUS AS FSTATUS,WO.FSCHEDULEDATE,WO.FSCHEDULEDATE AS FSCHEDULEDATEKEY
,MS.FMAINTENANCENAME,MS.FPRIORITYTYPE,DECODE(NVL(ME.FEQUIPMENTNAME,'N'),'N',ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPMENTNAME,MM.FNAME AS FMAINTANANCETYPE,WO.FPLANNEDDATE,WO.FPLANNEDDATE AS FPLANNEDDATEKEY,MW.FNAME AS FWORKGROUPNAME
,WO.FWORKORDERSTATUS AS FSTATUSKEY,WO.FSCHEDULEDATE AS FORDERSCHEDULEDATE,WO.FPLANNEDDATE AS FORDERDUEDATE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FLASTNAME))||' '||INITCAP(TO_CHAR(U.FFIRSTNAME))),',') WITHIN GROUP (ORDER BY U.FLASTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND WU.FUSERTYPE='A' AND WU.FSTATUS='A') AS FASSIGNEDTO

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FLASTNAME))||' '||INITCAP(TO_CHAR(U.FFIRSTNAME))),',') WITHIN GROUP (ORDER BY U.FLASTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND WU.FUSERTYPE='R' AND WU.FSTATUS='A') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME/60),2) FROM LDB1_MAINT_TASKS MT 
LEFT OUTER JOIN LDB1_MAINT_TASKGROUP TG ON TG.FIDENTIFIER=MS.FTASKGROUPIDENTIFIER AND TG.FSTATUS='A' AND TG.FSITEID=MS.FSITEID 
WHERE MT.FREFERENCEID=DECODE(NVL(WO.FTASKGROUPID,0),0,TG.FTASKGROUPID,WO.FTASKGROUPID) AND MT.FSITEID=MS.FSITEID) AS FESTIMATEDTIME

,(SELECT NVL(SUM(NVL(ROUND((TO_DATE(FENDDATE||' '||LPAD(FENDTIME,6,'0'),'YYYYMMDD hh24miSS') 
- TO_DATE(FSTARTDATE||' '||LPAD(FSTARTTIME,6,'0'),'YYYYMMDD hh24miSS'))*24*60,2),0)),0)
FROM LDB1_MAINT_WORKORDER_TASK WT WHERE WT.FWORK_ORDERID=WO.FWORK_ORDERID AND WT.FSITEID=MS.FSITEID AND WT.FENDDATE>0) AS FACTUALTIME

,TO_NUMBER(TO_CHAR(WO.FSTARTDATE || '' || LPAD(WO.FSTARTTIME,6,'0'))) AS FSTARTDATE,TO_NUMBER(TO_CHAR(WO.FENDDATE || '' || LPAD(WO.FENDTIME,6,'0'))) AS FENDDATE
,(U.FFIRSTNAME || ' ' || U.FLASTNAME) AS FSTARTEDBY
,TO_NUMBER(TO_CHAR(WO.FWORK_STARTDATE || '' || LPAD(WO.FWORK_STARTTIME,6,'0'))) AS FWORK_STARTDATE,TO_NUMBER(TO_CHAR(WO.FWORK_ENDDATE || '' || LPAD(WO.FWORK_ENDTIME,6,'0'))) AS FWORK_ENDDATE
,CASE NVL(WO.FLABORTIME,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FLABORTIME) END AS FLABORTIME,CASE NVL(WO.FTIMETAKEN,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FTIMETAKEN) END AS FACTUALDURATION
,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_STARTDATE || '' || LPAD(WO.FBREAKDOWN_STARTTIME,6,'0'))) AS FBREAKDOWN_STARTDATE,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_ENDDATE || '' || LPAD(WO.FBREAKDOWN_ENDTIME,6,'0'))) AS FBREAKDOWN_ENDDATE
,CASE NVL(WO.FBREAKDOWN_DURATION,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FBREAKDOWN_DURATION) END AS FBREAKDOWN_DURATION
FROM LDB1_MAINT_WORKORDER WO
INNER JOIN LDB1_MAINT_SCHEDULE MS ON MS.FSCHEDULEID=WO.FREF_SCHEDULEID AND MS.FSITEID=WO.FSITEID
INNER JOIN LDB1_MAINT_MASTER MM ON MM.FMASTERID=MS.FMAINTYPEID AND MM.FSITEID=MS.FSITEID
INNER JOIN LDB1_MAINT_MASTER MW ON MW.FMASTERID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND MW.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FEQUIPMENTID=MS.FEQUIPMENTID AND ME.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FLOCATIONID=MS.FLOCATIONID AND ML.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_USERINFO U ON U.FUSERID=WO.FSTARTEDBY
WHERE WO.FWORKORDERSTATUS NOT IN('INACTIVE','CREATED')
ORDER BY WO.FSCHEDULEDATE ASC;

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  CREATE OR REPLACE VIEW VW_MAINT_PLNTUSR_WORKODR_ODRVW AS 
 SELECT DISTINCT WO.FWORK_ORDERID,WO.FSITEID,DECODE(NVL(WO.FERP_WORKORDER,'N'),'N',LTRIM(WO.FWORK_ORDERID,'0'),WO.FERP_WORKORDER) AS WORKORDER,WO.FWORKORDERSTATUS AS FSTATUS,WO.FSCHEDULEDATE,WO.FSCHEDULEDATE AS FSCHEDULEDATEKEY
,MS.FMAINTENANCENAME,MS.FPRIORITYTYPE,DECODE(NVL(ME.FEQUIPMENTNAME,'N'),'N',ML.FLOCATIONNAME,ME.FEQUIPMENTNAME) AS FEQUIPMENTNAME,MM.FNAME AS FMAINTANANCETYPE,WO.FPLANNEDDATE,WO.FPLANNEDDATE AS FPLANNEDDATEKEY,MW.FNAME AS FWORKGROUPNAME
,WO.FWORKORDERSTATUS AS FSTATUSKEY,MA.FREFERENCEID,WU.FUSERID,WO.FSCHEDULEDATE AS FORDERSCHEDULEDATE,WO.FPLANNEDDATE AS FORDERDUEDATE

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FLASTNAME))||' '||INITCAP(TO_CHAR(U.FFIRSTNAME))),',') WITHIN GROUP (ORDER BY U.FLASTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND FUSERTYPE='A') AS FASSIGNEDTO

,(SELECT LISTAGG((INITCAP(TO_CHAR(U.FLASTNAME))||' '||INITCAP(TO_CHAR(U.FFIRSTNAME))),',') WITHIN GROUP (ORDER BY U.FLASTNAME)
FROM LDB1_MAINT_WORKGROUPUSER WU
INNER JOIN LDB1_USERINFO U ON U.FUSERID=WU.FUSERID
WHERE WU.FWORKGROUPID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND WU.FSITEID=MS.FSITEID AND FUSERTYPE='R') AS FREPORTEDTO

,(SELECT ROUND(SUM(MT.FESTIMATEDTIME/60),2) FROM LDB1_MAINT_TASKS MT 
LEFT OUTER JOIN LDB1_MAINT_TASKGROUP TG ON TG.FIDENTIFIER=MS.FTASKGROUPIDENTIFIER AND TG.FSTATUS='A' AND TG.FSITEID=MS.FSITEID 
WHERE MT.FREFERENCEID=DECODE(NVL(WO.FTASKGROUPID,0),0,TG.FTASKGROUPID,WO.FTASKGROUPID) AND MT.FSITEID=MS.FSITEID) AS FESTIMATEDTIME

,(SELECT NVL(SUM(NVL(ROUND((TO_DATE(FENDDATE||' '||LPAD(FENDTIME,6,'0'),'YYYYMMDD hh24miSS') 
- TO_DATE(FSTARTDATE||' '||LPAD(FSTARTTIME,6,'0'),'YYYYMMDD hh24miSS'))*24*60,2),0)),0)
FROM LDB1_MAINT_WORKORDER_TASK WT WHERE WT.FWORK_ORDERID=WO.FWORK_ORDERID AND WT.FSITEID=MS.FSITEID AND WT.FENDDATE>0) AS FACTUALTIME

,TO_NUMBER(TO_CHAR(WO.FSTARTDATE || '' || LPAD(WO.FSTARTTIME,6,'0'))) AS FSTARTDATE,TO_NUMBER(TO_CHAR(WO.FENDDATE || '' || LPAD(WO.FENDTIME,6,'0'))) AS FEND_DATE
,(U.FFIRSTNAME || ' ' || U.FLASTNAME) AS FSTARTEDBY
,TO_NUMBER(TO_CHAR(WO.FWORK_STARTDATE || '' || LPAD(WO.FWORK_STARTTIME,6,'0'))) AS FWORK_STARTDATE,TO_NUMBER(TO_CHAR(WO.FWORK_ENDDATE || '' || LPAD(WO.FWORK_ENDTIME,6,'0'))) AS FWORK_ENDDATE
,CASE NVL(WO.FLABORTIME,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FLABORTIME) END AS FLABORTIME,CASE NVL(WO.FTIMETAKEN,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FTIMETAKEN) END AS FACTUALDURATION
,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_STARTDATE || '' || LPAD(WO.FBREAKDOWN_STARTTIME,6,'0'))) AS FBREAKDOWN_STARTDATE,TO_NUMBER(TO_CHAR(WO.FBREAKDOWN_ENDDATE || '' || LPAD(WO.FBREAKDOWN_ENDTIME,6,'0'))) AS FBREAKDOWN_ENDDATE
,CASE NVL(WO.FBREAKDOWN_DURATION,0) WHEN 0 THEN '' ELSE TO_CHAR(WO.FBREAKDOWN_DURATION) END AS FBREAKDOWN_DURATION
FROM LDB1_MAINT_WORKORDER WO
INNER JOIN LDB1_MAINT_SCHEDULE MS ON MS.FSCHEDULEID=WO.FREF_SCHEDULEID AND MS.FSITEID=WO.FSITEID
INNER JOIN LDB1_MAINT_MASTER MM ON MM.FMASTERID=MS.FMAINTYPEID AND MM.FSITEID=MS.FSITEID
INNER JOIN LDB1_MAINT_MASTER MW ON MW.FMASTERID=DECODE(NVL(WO.FWORKGROUPID,0),0,MS.FWORKGROUPID,WO.FWORKGROUPID) AND MW.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_EQUIPMENT ME ON ME.FEQUIPMENTID=MS.FEQUIPMENTID AND ME.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_LOCATIONS ML ON ML.FLOCATIONID=MS.FLOCATIONID AND ML.FSITEID=MS.FSITEID
LEFT OUTER JOIN LDB1_MAINT_AUTH_GROUP MA ON MA.FREFERENCEID=DECODE(NVL(MS.FLOCATIONID,0),0,MS.FEQUIPMENTID,MS.FLOCATIONID) AND MA.FTYPE=DECODE(NVL(MS.FLOCATIONID,0),0,'EQUIPMENT','LOCATION') AND MA.FSITEID=MS.FSITEID AND MA.FSTATUS='A'
LEFT OUTER JOIN LDB1_MAINT_WORKGROUPUSER WU ON WU.FWORKGROUPID=MA.FWORKGROUPID AND WU.FSITEID=MS.FSITEID AND WU.FSTATUS='A'
LEFT OUTER JOIN LDB1_USERINFO U ON U.FUSERID=WO.FSTARTEDBY
WHERE WO.FWORKORDERSTATUS NOT IN('INACTIVE','CREATED')
ORDER BY WO.FSCHEDULEDATE ASC;